###############################################################################
# Mosquitto MQTT Broker Configuration Template (SAFE TO COMMIT)
#
# Copy to:
#   mosquitto.env
# Edit mosquitto.env locally with real values (do NOT commit mosquitto.env).
###############################################################################

# -----------------------------------------------------------------------------
# Network / listeners
# -----------------------------------------------------------------------------
# TLS listener
MOSQ_LISTENER_PORT=8883
MOSQ_BIND_ADDRESS=0.0.0.0

# Plaintext listener (optional)
# - If enabled, the installer uses bind_address + port to avoid a Mosquitto
#   2.0.18 double-bind issue with "listener 1883 ..." on Ubuntu 24.04.
# - Default binds to localhost even if UFW opens 1883.
OPEN_PLAINTEXT_1883=false
MOSQ_PLAINTEXT_BIND_ADDRESS=127.0.0.1

# -----------------------------------------------------------------------------
# Mosquitto config paths
# -----------------------------------------------------------------------------
MOSQ_CONF_MAIN=/etc/mosquitto/mosquitto.conf
MOSQ_CONF_DIR=/etc/mosquitto/conf.d

# -----------------------------------------------------------------------------
# TLS certs (Let's Encrypt layout recommended)
# IMPORTANT: these paths must match LETSENCRYPT_DOMAIN below.
# -----------------------------------------------------------------------------
MOSQ_CA_FILE=/etc/letsencrypt/live/mqtt.example.com/fullchain.pem
MOSQ_CERT_FILE=/etc/letsencrypt/live/mqtt.example.com/fullchain.pem
MOSQ_KEY_FILE=/etc/letsencrypt/live/mqtt.example.com/privkey.pem

# -----------------------------------------------------------------------------
# Auth (password file)
# -----------------------------------------------------------------------------
MOSQ_PASSWORD_FILE=/etc/mosquitto/passwd
MOSQ_ALLOW_ANONYMOUS=false

# Optionally create one initial user during install (you can add more later).
# If MQTT_PASSWORD is blank, installer will prompt securely.
CREATE_MQTT_USER=true
MQTT_USERNAME=changeme
MQTT_PASSWORD=

# -----------------------------------------------------------------------------
# ACL (recommended)
# -----------------------------------------------------------------------------
MOSQ_ENABLE_ACL=true
MOSQ_ACL_FILE=/etc/mosquitto/aclfile

# If enabled, installer can optionally write a starter ACL allowing the initial
# user to publish/subscribe under a single prefix.
WRITE_DEFAULT_ACL=true
ACL_TOPIC_PREFIX=test/#

# -----------------------------------------------------------------------------
# Logging
# Valid values: stdout, stderr, syslog, topic, file
# -----------------------------------------------------------------------------
MOSQ_LOG_DEST=file
MOSQ_LOG_FILE=/var/log/mosquitto/mosquitto.log

# -----------------------------------------------------------------------------
# Persistence
# -----------------------------------------------------------------------------
MOSQ_PERSISTENCE=true
MOSQ_PERSISTENCE_LOCATION=/var/lib/mosquitto/

# -----------------------------------------------------------------------------
# Firewall (UFW)
# -----------------------------------------------------------------------------
UFW_ALLOW=true

# -----------------------------------------------------------------------------
# Optional: mutual TLS (advanced)
# -----------------------------------------------------------------------------
REQUIRE_CLIENT_CERT=false

# -----------------------------------------------------------------------------
# Let's Encrypt automation
# -----------------------------------------------------------------------------
LETSENCRYPT_ENABLE=true
LETSENCRYPT_DOMAIN=mqtt.example.com
LETSENCRYPT_EMAIL=admin@example.com
LETSENCRYPT_STAGING=false

# -----------------------------------------------------------------------------
# Let's Encrypt permissions
# Some Ubuntu installs keep /etc/letsencrypt/{live,archive} as 0700 root:root,
# which prevents mosquitto from traversing symlinks to privkey*.pem.
# -----------------------------------------------------------------------------
LETSENCRYPT_FIX_DIR_PERMS=true
